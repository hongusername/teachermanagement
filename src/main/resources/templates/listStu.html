<!DOCTYPE html>
<html lang="en">
<head>
    <script src="./js/jquery.min.js"></script>
    <script src="./wei/bootstrap.min.js"></script>
    <link href="./wei/bootstrap.css" rel="stylesheet">
    <link href="./wei/style.css" rel="stylesheet">
    <link rel="stylesheet" href="./wei/layui/css/layui.css" media="all">
    <title>学生管理页面 - 首页</title>

    <script>
        $(function () {
            $("ul.pagination li.disabled a").click(function () {
                return false;
            });
        });
    </script>
</head>

<body>

<div class="listDIV">
    <table style="margin-top: 30px" class="table table-striped table-bordered table-hover table-condensed">

        <thead>
        <tr class="success">
            <th><input type="checkbox" onclick="allcheck(this)"></th>
            <th>学号</th>
            <th>姓名</th>
            <th>手机号</th>
            <th>班级</th>

            <th>编辑</th>
            <th>删除</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="list : ${list.list}">
            <td><input type="checkbox"></td>
            <td th:text="${list.stu_id}"></td>
            <td th:text="${list.stu_name}"></td>
            <td th:text="${list.stu_phone}"></td>
            <td th:text="${list.getClasses().getClass_name()}"></td>
            <td>
                <button type="button" onclick="bottom(this)" class="btn btn-default" data-container="body"
                        data-toggle="popover" data-placement="left" data-content='<!DOCTYPE html>
<html lang="en">
<head>

    <script src="./js/jquery.min.js"></script>
     <script src="./wei/bootstrap.min.js"></script>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./wei/style.css" rel="stylesheet">

    <title>学生管理页面 - 编辑页面</title>
</head>

<body>

<div class="editDIV">

    <div class="panel panel-success">
        <div class="panel-heading">
            <h3 class="panel-title">编辑学生</h3>
        </div>
        <div class="panel-body">

            <form method="post" action="/updateStu" role="form">
                <table class="editTable" th:each="detail : ${detail}">
                    <tr>
                        <td><input type="hidden" name="stu_id" id="student_id"
                                   placeholder="请在这里输入学号"></td>
                    </tr>
                    <tr>
                        <td>姓名：</td>
                        <td><input type="text" name="stu_name" id="stu_name"
                                   placeholder="请在这里输入名字">
                        </td>
                    </tr>
                    <tr>
                        <td>手机号 ：</td>
                        <td><input type="text" name="stu_phone" id="stu_phone"
                                   placeholder="请在这里输入手机号">
                        </td>
                    </tr>
                    <tr>
                        <td>班级：</td>
                        <td>
                            <select id="selectcla" name="classes.class_id"  >


                            </select>
                    </tr>
                    <tr class="submitTR">
                        <td colspan="2" align="center">
                            <input type="hidden" name="id" value="${student.id}">
                            <button type="submit" class="btn btn-success">提 交</button>
                        </td>

                    </tr>

                </table>
            </form>
        </div>
    </div>

'>


                    <span class="glyphicon glyphicon-edit"></span>
                </button>

                <script>
                    function bottom(b) {
                        var id = $(b).parent().prev().prev().prev().prev().html();
                        var claid = 0;
                        $.post("/toupdateStu", {"stu_id": id}, function (r, s) {
                            if (s == "success") {
                                claid = r.stu_class;
                                $("#stu_name").val(r.stu_name);
                                $("#stu_phone").val(r.stu_phone);
                                $("#student_id").val(r.stu_id);
                            }
                        }, "json");
                        $.post("/toupdateStulist", {}, function (r, s) {
                            if (s == "success") {
                                var html = "";
                                for (var i = 0; i < r.length; i++) {
                                    if (claid == r[i].class_id) {
                                        html += "<option selected='selected' value='" + r[i].class_id + "' >" + r[i].class_name + "</option>"
                                    } else {
                                        html += "<option value='" + r[i].class_id + "'>" + r[i].class_name + "</option>"
                                    }
                                }
                                $("#selectcla").html(html)
                            }
                        }, "json");
                    }
                </script>
            </td>
            <td><a href="#" th:onclick="'javascript:del(\''+${list.stu_id}+'\',this)'"><span
                    class="glyphicon glyphicon-trash"></span> </a>
            </td>
        </tr>
        </tbody>
    </table>

</div>
<div id="demo7"></div>


<nav class="pageDIV">
</nav>

<div class="addDIV">

    <div class="panel panel-success">
        <div class="panel-heading">
            <h3 class="panel-title">增加学生</h3>
        </div>
        <div class="panel-body">

            <form method="post" action="/addStu" role="form">
                <table class="addTable">
                    <tr>
                        <td>姓名：</td>
                        <td><input type="text" name="stu_name" id="name" placeholder="请在这里输入名字"></td>
                    </tr>
                    <tr>
                        <td>手机号：</td>
                        <td><input type="text" name="stu_phone" id="phone" placeholder="请在这里输入手机号"></td>
                    </tr>
                    </tr>
                    <tr>
                        <td>班级：</td>
                        <td>
                            <select name="stu_class">
                                <option value="0">请在这里选择班级</option>
                                <option th:value="${listClass.Class_type}" th:each="listClass : ${listClass}"
                                        th:text="${listClass.Class_name}"></option>
                            </select>
                    </tr>
                    <tr class="submitTR">
                        <td colspan="2" align="center">
                            <button type="submit" class="btn btn-success">提 交</button>
                        </td>

                    </tr>

                </table>
            </form>
        </div>
    </div>

</div>


</body>
</html>
<script src="./wei/layui/layui.js" charset="utf-8"></script>
<script>
    $(function () {
        $("[data-toggle='popover']").popover({
            html: true
        });
    });
</script>
<script>
    layui.use(['laypage', 'layer'], function () {
        var laypage = layui.laypage
            , layer = layui.layer;

        /*layui.use(['laypage','layer'],function () {
            var laypage = layui.laypage;
            laypage.render({
                elem: 'page'
                ,curr:${uPage.pageNum}
                ,count:${uPage.total}
                ,limit:${uPage.pageSize}
                ,layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                ,jump: function(obj,first){
                    if(!first){
                        location.href="/listUser?pageNum="+obj.curr+"&pageSize="+obj.limit;
                    }
                }
            });
        })*/
        //完整功能
        laypage.render({
            elem: 'demo7'
            , count: [[${list.total}]]
            , limit: [[${list.pageSize}]]
            , curr: [[${list.pageNum}]]
            , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
            , jump: function (obj, first) {
                if (!first) {
                    location.href = "/queryStuAll?pageNum=" + obj.curr + "&pageSize=" + obj.limit;
                }
            }
        });
    });
</script>
<script>
    $(function () {
        $("form").submit(function () {
            var stu_name = $("[name=stu_name]").val();
            var stu_phone = $("[name=stu_phone]").val();
            var stu_class = $("[name=stu_class]").val();
            if (stu_name == "" || stu_name == null) {
                alert("姓名不能为空");
                return false;
            }
            if (stu_phone == "" || stu_phone == null) {
                alert("手机号不能为空");
                return false;
            }
            if (stu_class == 0) {
                alert("请选择班级");
                return false;
            }
        })
    })
</script>
<script>
    function del(stu_id, a) {
        alert(stu_id);
        $.post("detailStu", {stu_id: stu_id}, function (r, s) {
            if (confirm("确定删除吗?")) {
                if (s == "success") {
                    $(a).parent().parent().remove();
                    alert("删除成功!")
                } else {
                    alert("删除失败!")
                }
            }
        })
    }
</script>